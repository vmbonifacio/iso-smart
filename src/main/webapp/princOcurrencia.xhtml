<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Ocurrencia</ui:define>

    <ui:define name="content">
        <h:form>
          <div class="card crud-demo">
              <h:form id="form">
                  <p:growl id="messages" showDetail="true" />

                  <p:toolbar>
                      <p:toolbarGroup>
                         <p:commandButton value="Nueva Ocurrencia" type="button" onclick="PF('dlg1').show();" icon="pi pi-plus" class="mr-2" style="background-color:#3C9462; border:1px solid #3C9462;"/>

                          <p:commandButton value="Borrar" type="button" onclick="PF('dlg2').show();" icon="pi pi-trash" style="background-color:red; border:1px solid red;"/>

                      </p:toolbarGroup>
                      <p:toolbarGroup align="right">
                          <p:fileUpload mode="simple" skinSimple="true" label="Import" chooseIcon="pi pi-download" />
                          <p:commandButton value="Export" icon="pi pi-upload" styleClass="ui-button-help" ajax="false">
                              <p:dataExporter type="pdf" target="dt-products" fileName="products" />
                          </p:commandButton>
                      </p:toolbarGroup>
                  </p:toolbar>
                  
                  <p:dialog widgetVar="dlg1" modal="true" class="h-full w-5" style="background-color:#363636">
                      <h:outputText value="¿Qué ocurrencia desea registrar?" class="text-5xl text-center"/>
                      <div class="field col-12 md:col-6 w-full mt-8">
                      <p:selectOneRadio layout="responsive" columns="2"  class="text-4xl" onchange="handleChange(this)">
                          <f:selectItem itemLabel="Registro de Accidente" itemValue="1"/>
                          <f:selectItem itemLabel="Registro de Incidente" itemValue="2"/>
                      </p:selectOneRadio>
                      </div>
                  </p:dialog> 
                  <p:dialog  widgetVar="dlg2" modal="true" height="100" style="background-color:#363636">
                      <h:outputText value="¿Está seguro que desea eliminar este registro?" />
                  </p:dialog> 

                  <p:dataTable id="dt-products" widgetVar="dtProducts" var="product" value="#{crudView.products}"
                               reflow="true" styleClass="products-table" selection="#{crudView.selectedProducts}"
                               rowKey="#{product.id}" paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">
                      <f:facet name="header">
                          <div class="products-table-header">
                              <span style="font-weight: bold">Ocurrencias registradas</span>
                              <span class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i>
                                  <p:inputText id="globalFilter" onkeyup="PF('dtProducts').filter()" placeholder="Search" />
                              </span>
                          </div>
                      </f:facet>
                      
                      <p:column selectionMode="multiple" exportable="false"></p:column>

                      <p:column headerText="Codigo" filterBy="#{product.codigo}" class="w-1 text-center">
                          <h:outputText value="#{product.codigo}" />
                      </p:column>
                      <p:column headerText="Nombre" filterBy="#{product.nombre}" class="text-center">
                          <h:outputText value="#{product.nombre}" />
                      </p:column>
                      <p:column headerText="Tipo de ocurrencia" filterBy="#{product.tocu}">
                          <h:outputText value="#{product.tocu}" />
                      </p:column>
                      <p:column headerText="Fecha de Registro" filterBy="#{product.fecha}">
                          <h:outputText value="#{product.fecha}" />
                      </p:column>
                      <p:column headerText="N° de personas afectadas" filterBy="#{product.peafec}">
                          <h:outputText value="#{product.peafec}" />
                      </p:column>
                      <p:column exportable="false" headerText="Acción" class="text-center" >
                          <p:commandButton icon="pi pi-pencil" 
                                           oncomplete="PF('manageProductDialog').show()"
                                           styleClass="edit-button rounded-button ui-button-success" process="@this">
                              <f:setPropertyActionListener value="#{product}" target="#{crudView.selectedProduct}" />
                          </p:commandButton>
                          <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash"
                                           process="@this"
                                           oncomplete="PF('deleteProductDialog').show()">
                              <f:setPropertyActionListener value="#{product}" target="#{crudView.selectedProduct}" />
                          </p:commandButton>
                      </p:column>

                  </p:dataTable>
              </h:form>
              <script>
                function handleChange(radio) {
                    if (radio.value === '1') {
                        window.location.href = 'formAccidente.xhtml';
                    }else if(radio.value === '2'){
                        window.location.href = 'formIncidente.xhtml';
                    }else{
                        window.location.href = 'princOcurrencia.xhtml';
                    }
                }
              </script>
          </div>
        </h:form>
    </ui:define>
</ui:composition>
